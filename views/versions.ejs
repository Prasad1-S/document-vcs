<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Version History - <%= title %></title>
  <link rel="icon" type="image/png" href="/assets/logoo.png">
  <link rel="stylesheet" href="/css/versions.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons@3.3.1/css/all/all.min.css">
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <a href="/home" class="logo_name">DocuVault</a>
  <div class="profileDetails">
    <div class="newDoc"><i class="fi fi-br-plus"></i></div>
    <div class="home"><i class="fi fi-br-house-chimney"></i></div>
    <% if(imgUrl){ %>
      <img src="<%= imgUrl %>" class="profile" height="40" alt="Profile">
    <% } else { %>
      <img src="/assets/github.png" class="profile" height="40" alt="Profile">
    <% } %>
  </div>
</div>

<!-- Profile Menu -->
<div class="logout">
  <button class="prof"><i class="fi fi-rr-document"></i><span>My Profile</span></button>
  <button class="setti"><i class="fi fi-rr-settings"></i><span>Settings</span></button>
  <button class="log"><i class="fi fi-rr-power"></i><span>Logout</span></button>
</div>

<main class="version-history">

  <!-- LEFT: VERSION LIST -->
  <aside class="versions-sidebar">
    <div class="sidebar-header">
      <h2>Version History</h2>
      <p class="current-version">Current: <strong>v<%= currentVersion %></strong></p>
    </div>

    <div class="versions-list">
      <% if (versions && versions.length) { %>
        <% versions.forEach(v => { %>
          <article class="version-card <%= v.isCurrent ? 'is-current' : '' %>"
                   data-docid="<%= docid %>"
                   data-version="<%= v.versionCount %>"
                   data-title="<%= v.title %>"
                   data-editor="<%= v.editor.name %>"
                   data-editor-img="<%= v.editor.imgUrl %>"
                   data-time="<%= v.updatedAt %>"
                   data-summary="<%= v.summary %>">

            <div class="version-card-header">
              <div class="version-avatar">
                <img src="<%= v.editor.imgUrl %>" alt="<%= v.editor.name %>">
              </div>
              <div class="version-meta">
                <div class="version-number">
                  v<%= v.versionCount %>
                  <% if (v.isCurrent) { %>
                    <span class="badge-current">Current</span>
                  <% } %>
                </div>
                <div class="version-author"><%= v.editor.name %></div>
                <div class="version-time"><%= v.updatedAt %></div>
              </div>
            </div>

            <% if (v.summary) { %>
              <p class="version-summary"><%= v.summary %></p>
            <% } %>

            <div class="version-content" style="display:none;"><%- v.content %></div>

            <div class="version-actions">
              <% if (!v.isCurrent) { %>
                <button class="btn-rollback" type="button">
                  <i class="fi fi-rr-time-past"></i> Rollback
                </button>
              <% } %>
            </div>
          </article>
        <% }) %>
      <% } else { %>
        <p class="no-versions">No version history available.</p>
      <% } %>
    </div>
  </aside>

  <!-- RIGHT: VERSION PREVIEW -->
  <section class="preview-panel">
    <div class="preview-header">
      <div class="preview-title-area">
        <h3 id="previewTitle"><%= title %></h3>
      </div>
    </div>

    <div class="preview-body">
      <div id="previewContent" class="preview-content">
        <%- currentcontent %>
      </div>
    </div>
  </section>

</main>

<!-- Rollback Confirmation Modal -->
<div id="rollbackModal" class="modal-overlay" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Confirm Rollback</h2>
        <button class="modal-close" id="closeModal" aria-label="Close">
          <i class="fi fi-rr-cross"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="warning-banner">
          <i class="fi fi-rr-triangle-warning"></i>
          <p><strong>Warning:</strong> This action cannot be undone. The current version will be replaced.</p>
        </div>

        <div class="rollback-info">
          <h3>Rolling back to:</h3>
          <dl>
            <dt>Version:</dt>
            <dd id="modalVersion">—</dd>

            <dt>Summary:</dt>
            <dd id="modalSummary">—</dd>

            <dt>Last Edited By:</dt>
            <dd id="modalEditor">—</dd>

            <dt>Date:</dt>
            <dd id="modalTime">—</dd>
          </dl>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelRollback">Cancel</button>
        <button class="btn btn-danger" id="confirmRollback">
          <i class="fi fi-rr-time-past"></i> Confirm Rollback
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/version.js"></script>
</body>
</html>
